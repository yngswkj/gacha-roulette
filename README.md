# 抽選ガチャガチャ

プロジェクター投影対応の汎用抽選アプリケーション

## 🎯 機能

### ✅ 実装済み（v3.0）

- **項目管理機能**
  - 項目の追加・編集・削除
  - 抽選済み/未抽選ステータスの切り替え
  - 全項目一括リセット
  - LocalStorageでデータ永続化

- **3つのタブ構成**
  - **管理タブ**: 項目の追加・編集・削除
  - **確認タブ**: 抽選対象の一覧表示
  - **抽選タブ**: 抽選実行と結果表示

- **物理演算ガチャ演出**
  - Matter.jsを使用した2D物理エンジン
  - 5段階のリアルタイムアニメーション:
    1. カプセル投入（2秒）
    2. カプセルシャッフル（3秒）
    3. 当選カプセル抽出（2秒）
    4. カプセル転がり演出（1.5秒）
    5. 結果表示準備（0.5秒）
  - 物理演算による自然な動き
  - カプセル同士の衝突判定

- **抽選機能**
  - 未抽選項目からランダムに1項目を選出
  - 当選した項目は自動的に「抽選済み」にマーク
  - フルスクリーンオーバーレイでの演出表示
  - 紙吹雪エフェクト

- **UI機能**
  - 項目一覧をカード形式で表示
  - 抽選済み項目はグレーアウト表示
  - 未抽選項目数の表示
  - トースト通知
  - レスポンシブデザイン

### 🚧 今後追加予定

- **効果音**
  - Web Audio APIによる効果音生成
  - カプセル投入音、衝突音、ファンファーレ

## 📂 ファイル構成

```
gacha-roulette/
├── index.html              # メインHTML
├── css/
│   └── style.css          # スタイルシート
├── js/
│   ├── app.js             # メインアプリケーション
│   ├── storage.js         # LocalStorage管理
│   ├── itemManager.js     # 項目管理ロジック
│   ├── uiController.js    # UI制御・タブ管理
│   ├── gachaPhysics.js    # 物理演算エンジン（Matter.js）
│   ├── animationManager.js # アニメーション管理
│   └── lottery.js         # 抽選機能（簡易版・非使用）
├── docs/
│   ├── gacha_implementation_plan.md
│   └── detailed_design.md
└── README.md
```

## 🚀 使い方

### 基本操作

1. **ブラウザでindex.htmlを開く**
   - ダブルクリックまたはブラウザにドラッグ&ドロップ

2. **管理タブで項目を管理**
   - 「項目を追加」ボタンで新しい項目を追加
   - カード上の編集ボタン（✏️）で項目名を変更
   - カード上の削除ボタン（🗑️）で項目を削除
   - カード上の切替ボタン（🔄）で抽選済み/未抽選を手動切替

3. **確認タブで抽選対象を確認**
   - 未抽選の項目一覧を確認
   - 「次へ：抽選実行」ボタンで抽選タブへ

4. **抽選タブで抽選を実行**
   - 「抽選開始」ボタンをクリック
   - 3秒間の演出後、結果画面に当選項目が表示される
   - 「もう一度抽選」で連続抽選可能
   - 「管理画面に戻る」で管理タブへ

5. **リセット**
   - 管理タブの「全項目をリセット」ボタンで全項目を未抽選に戻す

### デバッグ機能

ブラウザの開発者コンソール（F12）で以下のコマンドが利用可能:

```javascript
// デバッグ情報表示
gachaApp.debug()

// データをリセット
gachaApp.resetData()

// 項目一覧取得
gachaApp.itemManager.getAllItems()

// 未抽選項目取得
gachaApp.itemManager.getEligibleItems()
```

## 🎨 デザイン仕様

### カラーパレット

- **プライマリ**: `#FF6B6B` (赤系)
- **セカンダリ**: `#4ECDC4` (青緑系)
- **背景**: `#0f0f23` (ダークブルー)
- **サーフェス**: `#1a1a2e` (ダークグレー)
- **当選色**: `#FFD700` (ゴールド)

### タイポグラフィ

プロジェクター投影に最適化された大きなフォントサイズ:

- **タイトル**: 72px
- **見出し**: 48px
- **タブボタン**: 32px
- **ボタン（大）**: 48px
- **項目名**: 32-36px

## 🔧 技術スタック

### コア技術

- **HTML5**: セマンティックマークアップ
- **CSS3**:
  - Grid/Flexbox レイアウト
  - CSS Animations
  - CSS Variables
- **Vanilla JavaScript (ES6+)**:
  - クラスベース設計
  - Promiseによる非同期処理
  - イベント駆動アーキテクチャ

### ブラウザAPI

- **LocalStorage**: データ永続化

### 物理演算

- **Matter.js v0.19.0**: 2D物理エンジン
  - リアルタイム物理シミュレーション
  - 衝突検出とレスポンス
  - 重力・摩擦・反発係数

## 💾 データ構造

### 項目オブジェクト

```javascript
{
  id: 'uuid',              // ユニークID
  name: '項目名',          // 項目名（1-50文字）
  isWinner: false,         // 抽選済みフラグ
  color: '#FF6B6B',       // カプセル色（HEX）
  createdAt: 1234567890,  // 作成日時
  updatedAt: 1234567890   // 更新日時
}
```

### LocalStorage保存形式

```javascript
{
  version: '1.0',          // スキーマバージョン
  items: [...],            // 項目配列
  lastModified: 1234567890 // 最終更新日時
}
```

## 🌐 ブラウザ対応

- Chrome/Edge (最新版) ✅
- Firefox (最新版) ✅
- Safari (最新版) ✅

## 📱 レスポンシブ対応

- **デスクトップ**: 最適化済み
- **タブレット**: 対応済み
- **スマートフォン**: 対応済み

## 🐛 トラブルシューティング

### 項目が追加できない

- 項目名が空でないか確認
- 同じ名前の項目が既に存在しないか確認
- 最大50項目までという制限に達していないか確認

### データが保存されない

- ブラウザのプライベートモードではLocalStorageが無効です
- ブラウザのLocalStorageが有効か確認してください

### 抽選ボタンが押せない

- 未抽選の項目が1つ以上あるか確認
- 全項目が抽選済みの場合は「全項目をリセット」を実行してください

## 📝 開発者向け情報

### アーキテクチャ

3層レイヤー構造:

```
View Layer (UI)
    ↓
Business Logic Layer (ItemManager, Lottery)
    ↓
Service Layer (StorageService)
```

### クラス設計

- **GachaApp**: メインアプリケーション制御
- **StorageService**: LocalStorage操作
- **ItemManager**: 項目データ管理
- **UIController**: UI制御・タブ切り替え
- **GachaPhysicsEngine**: Matter.js物理演算エンジン
- **AnimationManager**: CSS/DOMアニメーション管理
- **SimpleLottery**: 抽選ロジック（簡易版・非使用）

### タブ構成

1. **管理タブ** (`manage`): 項目のCRUD操作
2. **確認タブ** (`confirm`): 抽選対象の確認
3. **抽選タブ** (`lottery`): 抽選実行と結果表示
   - `lottery-ready`: 抽選前
   - `lottery-running`: 抽選中
   - `lottery-result`: 結果表示

### 物理演算の仕組み

GachaPhysicsEngineは5つのフェーズで抽選を実行します:

1. **Phase 1 - カプセル投入**: 各項目をカプセルとして上から投入
2. **Phase 2 - シャッフル**: ランダムな力を加えてカプセルを混ぜる
3. **Phase 3 - 抽出**: 当選カプセルをゴールド色にハイライト
4. **Phase 4 - 転がり**: 当選カプセルを転がして注目させる
5. **Phase 5 - 結果表示**: オーバーレイを閉じて結果画面へ

## 📄 ライセンス

このプロジェクトは個人利用・商用利用ともに自由に使用できます。

## 🙏 クレジット

- 設計・実装: Claude Code
- 物理演算エンジン: Matter.js v0.19.0

---

**バージョン**: 3.0.0 (物理演算対応)
**最終更新**: 2025年11月4日

## 📋 変更履歴

### v3.0.0 (2025-11-04)
- Matter.js物理エンジンの統合
- 5段階の物理演算アニメーション実装
- フルスクリーンオーバーレイ演出
- 紙吹雪エフェクトの追加
- AnimationManagerクラスの追加

### v2.0.0 (2025-11-04)
- 用語を「チーム」から「項目」に変更（汎用性向上）
- タブナビゲーションの実装（管理・確認・抽選）
- UI/UXの大幅改善

### v1.0.0 (2025-11-03)
- 初回リリース
- 基本的な抽選機能実装
